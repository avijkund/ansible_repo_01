---
- name: Configure web server using ansible playbook
  hosts: db
  remote_user: avijit
  become: true
  become_user: root
  tasks:
    - name: Installing httpd package
      yum:
        name: httpd
        state: latest

    - name: Congigure custom httpd configuration
      lineinfile:
        path: /etc/httpd/conf/httpd.conf
        regexp: '^Listen'
        insertafter: '^#Listen'
        line: Listen 8081

    - name: Copying index file
      copy:
        dest: /var/www/html/index.html
        content: " This is a test HTML File"

    - name: Relabeling selinux port for apache
      seport:
        ports: 8081
        proto: tcp
        setype: http_port_t
        state: present

    - name: Allow port from firewall
      firewalld:
        port: 8081/tcp
        permanent: true
        state: enabled
        immediate: true

    - name: Start and enable http service
      service: 
        name: httpd
        state: restarted
        enabled: true

- name: Checking web configuration from localhost
  hosts: localhost
  become: false
  tasks:
    - name: using uri module to check the web status
      uri:
        url: http://client:8081
        return_content: true
      register: result
    - debug:
        var: result.content
